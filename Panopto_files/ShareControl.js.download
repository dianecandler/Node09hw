var Panopto=Panopto||{};Panopto.UI=Panopto.UI||{},Panopto.UI.ShareControl=function(e,o,a){var r,n,t,s,i,l,c=void 0===a?{}:a,p=c.isFolder,u=void 0!==p&&p,d=c.sendShareEmailsByDefault,h=void 0===d?Panopto.features.sendShareEmailsByDefault:d,P=c.toggleSubmit,g=void 0===P?$.noop:P,f=c.onToggleNoteError,v=void 0===f?$.noop:f,m=c.onToggleBulkAddError,S=void 0===m?$.noop:m,C=Panopto.Core.UI.Components.restSpinner(function(e){$("."+R).toggleClass("spinning",e)}),R="share-spinner",b="<div class='share-add'><ul class='share-add-input'><div class='"+R+"'></div></ul><select class='share-add-role' style='display:none;' tabindex='0'><@ _.each(roles, function (role) { @><option value='<@= role.value @>'><@= role.name @></option><@ }); @></select></div><div class='share-note' style='display:none;'><div class='share-notify'><label for='shareNotify'>"+Panopto.GlobalResources.ShareControl_Notify+"</label><input type='checkbox' id='shareNotify' class='share-notify-checkbox' tabindex='0' /></div><textarea class='share-note-input' tabindex='0'></textarea></div><div id='invitationWarning' style='display:none;'>"+Panopto.GlobalResources.Share_Default_Note+"&nbsp;<a target='_blank' href='<@= helpUrl @>'>"+Panopto.GlobalResources.Share_MoreInfo+"</a></div><div class='share-confirm'></div>",y=function(){return r.getModels().length>0},T=function(){var e=g();v(e&&!A(),String.format(Panopto.GlobalResources.Share_NotificationError,1200))},A=function(){return i.val().length<1200||!l.prop("checked")},I=[Panopto.Data.AclRoleType.Viewer];u&&((Panopto.features.creatorsCanAddCreatorsToFolders||Panopto.user.sitePermissions[PanoptoTS.Core.Permission.AccessControlPolicyCreate])&&I.push(Panopto.Data.AclRoleType.Creator),_.every(o,function(e){return e.arePublishersEditable})&&I.push(Panopto.Data.AclRoleType.Publisher)),e.html(_.template(b)({roles:_.map(I,function(e){return{value:e,name:Panopto.GlobalResources[PanoptoTS.StringHelpers.format("Share_Permission_{0}",_.invert(Panopto.Data.AclRoleType)[e])]}}),helpUrl:Panopto.useFreeTrialTerminology?Panopto.freeTrialSupportUrl:Panopto.Core.StringHelpers.getHelpUrl(Panopto.version,Panopto.Core.MajorSupportArea.Settings,Panopto.Core.MinorSupportArea.Sharing)})),t=e.find(".share-add-input"),r=Panopto.Core.UI.Components.tagSearch(t,function(e,a,r){var n={searchTerm:e,noAccessToItemId:void 0,noAccessToItemType:void 0};u?n.noAccessToItemType="Folder":(n.noAccessToItemId=o[0].id,n.noAccessToItemType=o[0].typeName),Panopto.Core.ServiceInterface.Rest.Access.readReceiverSuggestions(n,Panopto.Core.Constants.MaxSuggestionResults,function(e){var o=_.map(e,function(e){return{value:e.name,tagId:e.key||e.id,model:e}});a(o)},r,C.showUntilComplete())},{initialPlaceholder:u?Panopto.useFreeTrialTerminology?Panopto.GlobalResources.ShareControl_Folder_AddPlaceholder_Trial:Panopto.GlobalResources.ShareControl_Folder_AddPlaceholder:Panopto.useFreeTrialTerminology?Panopto.GlobalResources.ShareControl_AddPlaceholder_Trial:Panopto.GlobalResources.ShareControl_AddPlaceholder,suggestedUser:Panopto.GlobalResources.Groups_Membership_Suggestion,inviteRequest:Panopto.GlobalResources.ShareControl_InviteRequest,providerSuggestionText:Panopto.GlobalResources.TagSearch_ProviderSuggestion},{onChange:function(){var o=r.getModels(),a=(y(),e.find(".share-note")),n=$("#invitationWarning"),t=_.some(o,function(e){return e.isInviteRequest&&e.isInviteRequest()}),s=t||_.some(o,function(e){return e.email||e.typeName===Panopto.Core.ServiceInterface.Rest.Objects.TypeName.Group}),c=t||s&&!a.is(":visible")&&h;a.toggle(s),c?l.prop("checked",!0):s||l.prop("checked",!1),i.toggle(l.prop("checked")),l.prop("disabled",t),n.toggle(t),T()},suggestProviders:!0,passesBulkAddRestrictions:function(e){var o=e>Panopto.features.simultaneousShareSearchLimit;return S(o,Panopto.GlobalResources.Share_TagSearchLimitReached),!o}}),s=e.find(".share-add-role"),I.length>1?s.show():e.find(".share-notify").addClass("no-role-selector"),l=e.find("#shareNotify"),i=e.find(".share-note-input"),l.change(function(){i.toggle(this.checked),T()}),Panopto.Core.UI.Accessibility.checkbox(l),i.on("change keyup",function(){v(!A(),String.format(Panopto.GlobalResources.Share_NotificationError,1200))}),n=Panopto.Core.UI.Components.placeholder(i,Panopto.useFreeTrialTerminology&&!u?Panopto.GlobalResources.ShareControl_NotePlaceholder_Trial.format(Panopto.user.fullNameOrKey):Panopto.GlobalResources.ShareControl_NotePlaceholder,"placeholder");var G=Panopto.Core.Browser.isCssSupported("animation");return Panopto.Core.UI.Components.spinner($(".share-spinner"),G),{save:function(e,a){var t=[];_.each(o,function(e){_.each(r.getModels(),function(o){t.push(Panopto.Core.ServiceInterface.Rest.Objects.Access({item:e,receiver:o,role:o.isInviteRequest&&o.isInviteRequest()?Panopto.Data.AclRoleType.DirectViewerOnly:parseInt(s.val(),10)}))})}),t.length?Panopto.Core.ServiceInterface.Rest.Access.batchCreate(t,l.prop("checked"),n.val(),function(n){parseInt(s.val(),10)===Panopto.Data.AclRoleType.Publisher&&_.some(o,function(e){return!e.isApprovalRequired})&&confirm(1===o.length?Panopto.GlobalResources.ShareControl_RequireApprovalPrompt_Single:Panopto.GlobalResources.ShareControl_RequireApprovalPrompt_Multiple)&&(_.each(o,function(e){e.isApprovalRequired=!0}),Panopto.Core.ServiceInterface.Rest.FolderAccessItems.saveMany(o)),r.clear(),n.failed.length?a(!!n.succeeded.length,n.failed):e()},function(){a(!1)}):e()},cancel:function(){r.clear()},hasChanges:y,isPending:function(){return r.hasPendingTags()},passesValidation:A,shouldSend:function(){return l.prop("checked")&&y()},addMeetingParticipants:function(e){_.each(e,function(e){return r.addManualTag(e)})}}};
//# sourceMappingURL=file://seasyn/tfsbuilds/panopto_core_rel-rtc-8.11.2_x64/20200611.12/_PublishedWebsites/WebUI/Scripts/Panopto/Pages/Share/ShareControl.js.map
